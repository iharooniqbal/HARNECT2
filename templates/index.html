<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HARNECT — Feed</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- Top Nav -->
  <header class="top-nav">
    <div class="logo">HARNECT</div>
    <div class="page-title">Home</div>
    <div class="theme-toggle" id="themeToggle">🌙</div>
  </header>

<!-- Stories Section -->
<div class="stories">
  <!-- My Story -->
  {% if user %}
    {% set my_story = stories | selectattr('user', 'equalto', user) | list %}
    {% if my_story %}
      <div class="story" onclick="openStories('{{ user }}')">
        <div class="story-circle">
          <img src="{{ url_for('static', filename='uploads/' + my_story[0].filename) }}" alt="My Story">
        </div>
        <p>You</p>
      </div>
    {% endif %}
  {% endif %}

 <!-- Other Users' Stories -->
{% set shown_users = [] %}
{% for story in stories %}
  {% if story.user not in shown_users %}
    {% set _ = shown_users.append(story.user) %}
    <div class="story" onclick="openStories('{{ story.user }}')">
      <div class="story-circle">
        <img src="{{ url_for('static', filename='uploads/' + story.filename) }}" alt="@{{ story.user }} Story">
      </div>
      <p>@{{ story.user }}</p>
    </div>
  </div>
  {% endif %}
{% endfor %}
  </div>

  <!-- Feed Section -->
  <main class="feed">
    {% for post in posts %}
      <div class="post" id="post-{{ post.filename }}">
        {% if post.filename.endswith(('.mp4','.webm','.ogg','.avi')) %}
          <video controls>
            <source src="{{ url_for('static', filename='uploads/' + post.filename) }}" type="video/mp4">
          </video>
        {% else %}
          <img src="{{ url_for('static', filename='uploads/' + post.filename) }}" alt="{{ post.caption }}">
        {% endif %}

        <div class="post-info">
          <p><strong>@{{ post.user }}</strong></p>
          <p>{{ post.caption }}</p>
        </div>
      </div>
    {% endfor %}
  </main>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <a href="{{ url_for('index') }}" class="active">🏠<span>Home</span></a>
    <a href="{{ url_for('explore') }}">🔍<span>Explore</span></a>
    <a href="{{ url_for('upload') }}" class="upload-btn">➕</a>
    <a href="{{ url_for('feedback') }}">💬<span>Feedback</span></a>
    <a href="{% if user %}{{ url_for('profile', username=user) }}{% else %}{{ url_for('login') }}{% endif %}">👤<span>Profile</span></a>
  </nav>

  <script id="storiesData" type="application/json">
    {{ stories | tojson }}
  </script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
